---
title: "**Exploratory Overview**"
output: 
  html_document:
    code_folding: hide
---

This page provides an exploratory summary of three datasets used in this project:

(1) NYC Leading Causes of Death in 2021
(2) Automated Traffic Volume Counts (2019–2024)
(3) NYC Automated External Defibrillator (AED) Inventory

These summaries help us understand patterns of mortality burden, congestion levels, and AED accessibility across boroughs, and they motivate our later analysis linking traffic conditions to emergency response readiness.

```{r setup, include=FALSE}
##Setup necessary libraries
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
library(janitor)
library(stringr)
library(kableExtra)
library(plotly)
```

```{r import, include=FALSE}
##Import datasets
zip_path = "./data/Automated_Traffic_Volume_Counts.zip"
csv_filename_in_zip = "Automated_Traffic_Volume_Counts.csv"
traffic_volume_df = read_csv(unz(description = zip_path, filename = csv_filename_in_zip))

aed_inventory_df = read_csv("./data/NYC_Automated_External_Defibrillator_(AED)_Inventory.csv")
leading_causes_df = read_csv("./data/NYC_Leading_Causes_of_Death.csv")
```

```{r traffic_clean, include=FALSE}
##Traffic data (2019-2024)
traffic_clean = traffic_volume_df |>
  clean_names() |>
  filter(yr >= 2019, yr <= 2024) |>
  mutate(boro = str_to_title(boro))
```

```{r aed_clean, include=FALSE}
##AED inventory
aed_clean = aed_inventory_df |>
  clean_names() |>
  filter(!is.na(latitude), !is.na(longitude)) |>
  mutate(borough = str_to_title(borough))
```

```{r cause_clean, include=FALSE}
##Leading causes of death
leading_clean = leading_causes_df |>
  clean_names() |>
  mutate(
    deaths = as.numeric(deaths),
    death_rate = as.numeric(death_rate),
    age_adjusted_death_rate = as.numeric(age_adjusted_death_rate)
    )
```


### <img src="icons/heart-disease.png" width="40" style="vertical-align:-10px;"> **Leading causes of death**

_Table 1_ shows that in 2021, diseases of the heart caused the highest number of deaths in NYC (more than 16,500). This is much higher than any other cause. _Figure 1_ shows this visually: the bar for heart disease is the longest. Because heart problems can lead to sudden cardiac arrest, this information supports why studying AED access is important. Quick defibrillation can save lives, so understanding AED availability in each borough matters.

```{r leading_sum}
leading_clean2 = leading_clean |>
  mutate(
    cause_name = str_replace(leading_cause, " \\(.*\\)$", "")
  )

death_baseline = leading_clean2 |>
  filter(year == 2021) |>
  group_by(cause_name) |>
  summarise(
    total_deaths = sum(deaths, na.rm = TRUE),
    .groups = "drop"
  ) |>
  arrange(desc(total_deaths))

death_baseline_display = death_baseline |>
  mutate(
    total_deaths = format(total_deaths, big.mark = ",", scientific = FALSE)
  ) |>
  rename(
    `Cause of death`       = cause_name,
    `Total deaths (2021)`  = total_deaths
  )

death_baseline_display |>
  kable(
    caption = "Table 1. Leading causes of death in NYC, 2021",
    format = "html"
  ) |>
  kable_styling(
    full_width = FALSE,
    bootstrap_options = c("striped", "hover", "bordered")
  )

```

```{r leading_bar}
death_baseline |>
  slice_max(order_by = total_deaths, n = 10) |>
  ggplot(aes(
    x    = reorder(cause_name, total_deaths),
    y    = total_deaths,
    fill = total_deaths          # map fill to deaths
  )) +
  geom_col() +
  coord_flip() +
  theme_minimal() +
  scale_x_discrete(labels = ~ str_wrap(., width = 35)) +  # wrap labels
  scale_fill_gradient(low = "#fee0d2", high = "#de2d26") +
  guides(fill = "none") +
  labs(
    title = "Figure 1: Top 10 causes of death in NYC, 2021",
    x     = "Cause of death",
    y     = "Total deaths"
  )
```

### <img src="icons/warning.png" width="40" style="vertical-align:-10px;"> **Traffic volume summary**

_Table 2_ summarizes traffic measurements for each borough. Queens and Brooklyn have the most measurements and the most monitored street segments. Manhattan has the highest mean and median traffic volume, which matches what we expect for a busy business and tourist area.

```{r traffic_sum}
traffic_summary = traffic_clean |>
  group_by(boro) |>
  summarise(
    n_measurements = n(),
    unique_segments = n_distinct(segment_id),
    mean_volume = mean(vol, na.rm = TRUE),
    median_volume = median(vol, na.rm = TRUE),
    .groups = "drop"
  ) |>
  rename(borough = boro)

traffic_summary_display = traffic_summary |>
  rename(
    Borough = borough,
    `Number of measurements`     = n_measurements,
    `Number of monitored segments` = unique_segments,
    `Mean traffic volume`        = mean_volume,
    `Median traffic volume`      = median_volume
  )

traffic_summary_display |>
  kable(
    caption     = "Table 2: Traffic volume summary by borough, 2019–2024",
    format      = "html",
    digits      = 2,
    format.args = list(big.mark = ",")   # add commas to all numeric cols
  ) |>
  kable_styling(
    full_width = FALSE,
    bootstrap_options = c("striped", "hover", "bordered")
  )
```

```{r traffic_vol_hist}
traffic_clean |>
  ggplot(aes(x = vol)) +
  geom_histogram(
    bins  = 60,
    fill  = "#3182bd",   # bar color
    color = "white"      # bar border
  ) +
  coord_cartesian(xlim = c(0, 400)) +
  theme_minimal() +
  labs(
    title = "Figure 3: Distribution of traffic volume (0–400, all boroughs, 2019–2024)",
    x     = "Traffic volume",
    y     = "Count"
  )
```

_Figure 3_ shows the distribution of traffic volume for all boroughs from 2019 to 2024. The shape of the distribution is right-skewed. Most traffic counts are below 100 vehicles, which we can consider low or medium traffic. Fewer observations fall between 100 and 200 vehicles, and only a small number go above 200, which we consider very high traffic.

This means that while many streets are not very busy, some specific areas experience heavy congestion. These high-traffic areas are more likely to delay emergency vehicles, such as ambulances, from reaching patients on time.

```{r trafficbox}
traffic_clean |>
  ggplot(aes(x = boro, y = vol, fill = boro)) +
  geom_boxplot(outlier.shape = NA, alpha = 0.8) +
  coord_cartesian(ylim = c(0, 400)) +
  theme_minimal() +
  labs(
    title = "Figure 4: Traffic volume by borough, 2019–2024 (0–400)",
    x     = "Borough",
    y     = "Traffic volume",
    fill  = "Borough"
  ) +
  theme(
    legend.position = "bottom"
  )
```

In _Figure 4_, Manhattan’s boxplot shows the highest median traffic and the widest spread, meaning traffic levels vary a lot across locations. Queens and Brooklyn show medium levels, while the Bronx and Staten Island have lower and more stable traffic. These differences show how each borough has its own traffic profile, which can affect how quickly emergency services can reach someone.

```{r traffictrend_covid}
traffic_trend = traffic_clean |>
  group_by(yr, boro) |>
  summarise(
    mean_volume = mean(vol, na.rm = TRUE),
    .groups = "drop"
  )

ggplot(traffic_trend, aes(x = yr, y = mean_volume, color = boro, group = boro)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  theme_minimal() +
  labs(
    title = "Figure 5: Mean traffic volume trend by borough (2019–2024)",
    x     = "Year",
    y     = "Mean traffic volume",
    color = "Borough"
  )

```

_Figure 5_ shows how traffic changed from 2019 to 2024. All boroughs show a drop in 2020 because of the COVID-19 shutdown. After that, traffic increases again but follows different patterns:

* Manhattan always has the highest levels and the biggest changes from year to year.
* Queens and Brooklyn increase in some years, especially around 2023.
* The Bronx remains more stable with lower overall traffic.
* Staten Island saw a substantial increase in 2022, followed by a significant drop, which could be due to fewer monitored locations.

These trends help us understand how changes in traffic over time might affect AED use or emergency response.

### <img src="icons/aed.png" width="40" style="vertical-align:-10px;"> **AED summary**
```{r aedsum}
aed_summary = aed_clean |>
  group_by(borough) |>
  summarise(
    n_facilities        = n(),                               # number of AED-equipped locations
    mean_aeds_per_site  = mean(aed_num_aeds, na.rm = TRUE),
    mean_trained_people = mean(aed_num_person_trained, na.rm = TRUE),
    .groups = "drop"
  )

aed_summary_display = aed_summary |>
  rename(
    Borough                        = borough,
    `Number of AED-equipped sites` = n_facilities,
    `Mean AEDs per site`           = mean_aeds_per_site,
    `Mean trained people per site` = mean_trained_people
  )

aed_summary_display |>
  kable(
    caption = "Table 3: AED-equipped facilities and trained personnel by borough",
    format  = "html"
  ) |>
  kable_styling(
    full_width = FALSE,
    bootstrap_options = c("striped", "hover", "bordered")
  )
```

```{r aed_pie, echo = FALSE}
aed_summary |>
  plot_ly(
    labels = ~borough,
    values = ~n_facilities,
    type   = "pie",
    textinfo  = "label+percent",
    hoverinfo = "label+value+percent"
  ) |>
  layout(
    title = "Figure 6: Distribution of AED-equipped sites by borough",
    legend = list(orientation = "h",
                  x = 0.5, xanchor = "center",
                  y = -0.1)
  )
```

_Table 3_ shows that AED availability is not equal across boroughs. Manhattan has the most AED sites (more than 3,600 locations). Queens and Brooklyn have moderate coverage, but the Bronx and Staten Island have the fewest AED sites.
_Figure 6_, the pie chart, makes these differences easy to see. Manhattan takes up the largest share of AED locations.

These differences suggest that some boroughs may have better access to life-saving devices than others. This matters because quick access to an AED is critical during a cardiac emergency, where every minute affects survival.

When we compare all data sources together, a consistent pattern appears. Cardiovascular disease is the leading cause of death in NYC, yet AED access and trained responders are not evenly distributed. Manhattan has the strongest AED coverage but also the highest traffic congestion, while boroughs with lower traffic—such as Staten Island—have fewer AED resources.
These findings highlight the need to examine how AED availability and traffic conditions interact to meet population needs.