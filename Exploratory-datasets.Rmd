---
title: "AED Accessibility and Traffic in NYC: Exploratory Data"
output: html_document
---
**Library**
```{r setup, message=FALSE, warning=FALSE}
library(tidyverse)
library(janitor)
library(stringr)
```


**Import data**
```{r import, message=FALSE, warning=FALSE}
zip_path = "./data/Automated_Traffic_Volume_Counts.zip"
csv_filename_in_zip = "Automated_Traffic_Volume_Counts.csv"
traffic_volume_df = read_csv(unz(description = zip_path, filename = csv_filename_in_zip))


aed_inventory_df = read_csv("./data/NYC_Automated_External_Defibrillator_(AED)_Inventory.csv")
leading_causes_df = read_csv("./data/NYC_Leading_Causes_of_Death.csv")

traffic_volume_df |> glimpse()
aed_inventory_df  |> glimpse()
leading_causes_df |> glimpse()
```

**Clean data**
```{r clean, message=FALSE}
traffic_clean = traffic_volume_df |>
  clean_names() |>
  filter(yr >= 2019, yr <= 2024) |>
  mutate(boro = str_to_title(boro))

aed_clean = aed_inventory_df |>
  clean_names() |>
  filter(!is.na(latitude), !is.na(longitude)) |>
  mutate(borough = str_to_title(borough))

leading_clean = leading_causes_df |>
  clean_names() |>
  mutate(
  deaths = as.numeric(deaths),
  death_rate = as.numeric(death_rate),
  age_adjusted_death_rate = as.numeric(age_adjusted_death_rate)
  )
```

### Summarize table

**Leading Causes of Death Summary by year**
```{r leading_sum, message=FALSE}
# Create a clean disease name without ICD codes
leading_clean2 = leading_clean |>
  mutate(
    cause_name = str_replace(leading_cause, " \\(.*\\)$", "")
  )

# Summarise total deaths by disease name for 2021
death_baseline = leading_clean2 |>
  filter(year == 2021) |>
  group_by(cause_name) |>
  summarise(
    total_deaths = sum(deaths, na.rm = TRUE),
    .groups = "drop"
  ) |>
  arrange(desc(total_deaths))

knitr::kable(
  death_baseline,
  caption = "Table 1: Leading causes of death in NYC, 2021 (disease names only)"
)
```

**Top 1: Diseases of Heart** ---> the importance of having AED

### Main analysis summary
**Traffic volume summary by borough**
```{r traffic_volume_sum, message=FALSE}
traffic_summary = traffic_clean |>
  group_by(boro) |>
  summarise(
    n_measurements = n(),
    unique_segments = n_distinct(segment_id),
    mean_volume = mean(vol, na.rm = TRUE),
    median_volume = median(vol, na.rm = TRUE)
  ) |>
rename(borough = boro)

knitr::kable(
  traffic_summary,
  caption = "Table 2: Traffic volume summary by borough (2019â€“2024)"
)
```


**AED inventory summary by borough**
```{r AED_sum, message=FALSE}
aed_summary = aed_clean |>
  group_by(borough) |>
  summarise(
    aed_locations = n(),
    mean_num_aeds = mean(aed_num_aeds, na.rm = TRUE),
    mean_trained  = mean(aed_num_person_trained, na.rm = TRUE)
  )

knitr::kable(
  aed_summary,
  caption = "Table 3: AED inventory summary by borough"
)
```


```{r baseline_table, message=FALSE}
baseline_table = left_join(aed_summary, traffic_summary, by = "borough")

knitr::kable(
  baseline_table,
  caption = "Table 4: Baseline summary of AED and traffic characteristics by borough"
)
```


