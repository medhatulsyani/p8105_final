---
title: "**Exploratory Overview**"
output: 
  html_document:
    code_folding: hide
---

This page provides an exploratory summary of three datasets used in this project:

(1) NYC Leading Causes of Death in 2021
(2) Automated Traffic Volume Counts (2019–2024)
(3) NYC Automated External Defibrillator (AED) Inventory

These summaries help us understand patterns of mortality burden, congestion levels, and AED accessibility across boroughs, and they motivate our later analysis linking traffic conditions to emergency response readiness.

```{r setup, include=FALSE}
##Setup necessary libraries
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
library(janitor)
library(stringr)
library(kableExtra)
library(plotly)
```

```{r import, include=FALSE}
##Import datasets
zip_path = "./data/Automated_Traffic_Volume_Counts.zip"
csv_filename_in_zip = "Automated_Traffic_Volume_Counts.csv"
traffic_volume_df = read_csv(unz(description = zip_path, filename = csv_filename_in_zip))

aed_inventory_df = read_csv("./data/NYC_Automated_External_Defibrillator_(AED)_Inventory.csv")
leading_causes_df = read_csv("./data/NYC_Leading_Causes_of_Death.csv")
```

```{r traffic_clean, include=FALSE}
##Traffic data (2019-2024)
traffic_clean = traffic_volume_df |>
  clean_names() |>
  filter(yr >= 2019, yr <= 2024) |>
  mutate(boro = str_to_title(boro))
```

```{r aed_clean, include=FALSE}
##AED inventory
aed_clean = aed_inventory_df |>
  clean_names() |>
  filter(!is.na(latitude), !is.na(longitude)) |>
  mutate(borough = str_to_title(borough))
```

```{r cause_clean, include=FALSE}
##Leading causes of death
leading_clean = leading_causes_df |>
  clean_names() |>
  mutate(
    deaths = as.numeric(deaths),
    death_rate = as.numeric(death_rate),
    age_adjusted_death_rate = as.numeric(age_adjusted_death_rate)
    )
```


### <img src="icons/heart-disease.png" width="40" style="vertical-align:-10px;"> **Leading causes of death**

In 2021, diseases of the heart were the leading cause of death in New York City, with more than 16,500 deaths—far exceeding all other causes. Malignant neoplasms and Covid-19 also accounted for substantial mortality. These patterns highlight the large burden of cardiovascular disease and reinforce the public health significance of rapid intervention during cardiac emergencies. Because survival during cardiac arrest depends strongly on timely defibrillation, these data support our focus on evaluating AED accessibility across boroughs.

```{r leading_sum}
leading_clean2 = leading_clean |>
  mutate(
    cause_name = str_replace(leading_cause, " \\(.*\\)$", "")
  )

death_baseline = leading_clean2 |>
  filter(year == 2021) |>
  group_by(cause_name) |>
  summarise(
    total_deaths = sum(deaths, na.rm = TRUE),
    .groups = "drop"
  ) |>
  arrange(desc(total_deaths))

death_baseline_display = death_baseline |>
  mutate(
    total_deaths = format(total_deaths, big.mark = ",", scientific = FALSE)
  ) |>
  rename(
    `Cause of death`       = cause_name,
    `Total deaths (2021)`  = total_deaths
  )

death_baseline_display |>
  kable(
    caption = "Table 1. Leading causes of death in NYC, 2021",
    format = "html"
  ) |>
  kable_styling(
    full_width = FALSE,
    bootstrap_options = c("striped", "hover", "bordered")
  )

```

```{r leading_bar}
death_baseline |>
  slice_max(order_by = total_deaths, n = 10) |>
  ggplot(aes(
    x    = reorder(cause_name, total_deaths),
    y    = total_deaths,
    fill = total_deaths          # map fill to deaths
  )) +
  geom_col() +
  coord_flip() +
  theme_minimal() +
  scale_x_discrete(labels = ~ str_wrap(., width = 35)) +  # wrap labels
  scale_fill_gradient(low = "#fee0d2", high = "#de2d26") +
  guides(fill = "none") +
  labs(
    title = "Figure 1: Top 10 causes of death in NYC, 2021",
    x     = "Cause of death",
    y     = "Total deaths"
  )
```

### <img src="icons/warning.png" width="40" style="vertical-align:-10px;"> **Traffic volume summary**
```{r traffic_sum}
traffic_summary = traffic_clean |>
  group_by(boro) |>
  summarise(
    n_measurements = n(),
    unique_segments = n_distinct(segment_id),
    mean_volume = mean(vol, na.rm = TRUE),
    median_volume = median(vol, na.rm = TRUE),
    .groups = "drop"
  ) |>
  rename(borough = boro)

traffic_summary_display = traffic_summary |>
  rename(
    Borough = borough,
    `Number of measurements`     = n_measurements,
    `Number of monitored segments` = unique_segments,
    `Mean traffic volume`        = mean_volume,
    `Median traffic volume`      = median_volume
  )

traffic_summary_display |>
  kable(
    caption     = "Table 2: Traffic volume summary by borough, 2019–2024",
    format      = "html",
    digits      = 2,
    format.args = list(big.mark = ",")   # add commas to all numeric cols
  ) |>
  kable_styling(
    full_width = FALSE,
    bootstrap_options = c("striped", "hover", "bordered")
  )
```

```{r traffic_vol_hist}
traffic_clean |>
  ggplot(aes(x = vol)) +
  geom_histogram(
    bins  = 60,
    fill  = "#3182bd",   # bar color
    color = "white"      # bar border
  ) +
  coord_cartesian(xlim = c(0, 400)) +
  theme_minimal() +
  labs(
    title = "Figure 3: Distribution of traffic volume (0–400, all boroughs, 2019–2024)",
    x     = "Traffic volume",
    y     = "Count"
  )
```

Traffic volume follows a right-skewed distribution: most roadway observations
fall below 100 vehicles, but a long tail extends toward very high-volume
locations. This indicates that while many intersections experience moderate
traffic, a smaller subset carries extremely heavy congestion. These high-volume areas could pose challenges for rapid emergency response during peak hours.

```{r trafficbox}
traffic_clean |>
  ggplot(aes(x = boro, y = vol, fill = boro)) +
  geom_boxplot(outlier.shape = NA, alpha = 0.8) +
  coord_cartesian(ylim = c(0, 400)) +
  theme_minimal() +
  labs(
    title = "Figure 4: Traffic volume by borough, 2019–2024 (0–400)",
    x     = "Borough",
    y     = "Traffic volume",
    fill  = "Borough"
  ) +
  theme(
    legend.position = "bottom"
  )
```

Traffic volume varies meaningfully by borough. Manhattan shows the highest
median traffic volume and the widest spread, consistent with its mix of dense
roadways, business districts, and tourism. Queens and Brooklyn display moderate traffic variability, while the Bronx and Staten Island have lower medians and narrower ranges. These differences highlight borough-specific traffic patterns that may affect travel times for emergency services.


### <img src="icons/aed.png" width="40" style="vertical-align:-10px;"> **AED summary**
```{r aedsum}
aed_summary = aed_clean |>
  group_by(borough) |>
  summarise(
    n_facilities        = n(),                               # number of AED-equipped locations
    mean_aeds_per_site  = mean(aed_num_aeds, na.rm = TRUE),
    mean_trained_people = mean(aed_num_person_trained, na.rm = TRUE),
    .groups = "drop"
  )

aed_summary_display = aed_summary |>
  rename(
    Borough                        = borough,
    `Number of AED-equipped sites` = n_facilities,
    `Mean AEDs per site`           = mean_aeds_per_site,
    `Mean trained people per site` = mean_trained_people
  )

aed_summary_display |>
  kable(
    caption = "Table 3: AED-equipped facilities and trained personnel by borough",
    format  = "html"
  ) |>
  kable_styling(
    full_width = FALSE,
    bootstrap_options = c("striped", "hover", "bordered")
  )
```

```{r aed_pie, echo = FALSE}
aed_summary |>
  plot_ly(
    labels = ~borough,
    values = ~n_facilities,
    type   = "pie",
    textinfo  = "label+percent",
    hoverinfo = "label+value+percent"
  ) |>
  layout(
    title = "Figure 5: Distribution of AED-equipped sites by borough",
    legend = list(orientation = "h",
                  x = 0.5, xanchor = "center",
                  y = -0.1)
  )
```

AED-equipped facilities are unevenly distributed across NYC. Manhattan has by
far the highest number of AED sites and the highest average number of trained
responders per facility. Queens and Brooklyn also show substantial AED coverage, while the Bronx and Staten Island have the lowest counts. These disparities may translate into unequal access to life-saving defibrillation, with some boroughs potentially facing delayed response during cardiac emergencies.

Across data sources, a consistent pattern emerges. Cardiovascular disease is the leading cause of death in NYC, yet access to AEDs and trained responders is not evenly distributed. Manhattan has the strongest AED coverage but also the highest traffic congestion, while low-traffic boroughs like Staten Island have fewer AED resources. These findings underscore the importance of examining how AED availability aligns with traffic conditions and population needs.
