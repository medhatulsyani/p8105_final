---
title: "AED Accessibility and Traffic Congestion in NYC"
output: 
  html_document:
    code_folding: hide
---

### **Overview**
<img src="icons/youtube_logo.png" width="40" style="vertical-align:-10px;"> screencast[insert link] Take a tour of our website!!

### **About**


<img src="icons/welcome_page.gif" width="600" style="display:block; margin:auto;">
<div style="text-align:center; font-size:12px; color:gray;">
*Source: RadianQBio (2018). “First Aid Training and AED Animation” YouTube.*</em>
</div>
<style>
@keyframes heartbeat {
  0%   { transform: scale(1); }
  20%  { transform: scale(1.15); }
  40%  { transform: scale(1); }
  60%  { transform: scale(1.15); }
  80%  { transform: scale(1); }
  100% { transform: scale(1); }
}

.beating-heart {
  color: red;
  font-weight: bold;
  display: inline-block;
  animation: heartbeat 4.0s infinite;
}
</style>


<span class="beating-heart">
Did You Know Cardiac Arrest Survival Increases by 38% when AED use and CPR are combined?
</span>

Our project explores how the placement of **Automated External Defibrillators (AEDs)** aligns with the traffic trends of one of the world’s busiest cities.Through a combination of data on AED locations, traffic volume, and cardiovascular disease, we will identify potential gaps in AED coverage in high-risk and high-traffic areas.

### **Maps of NYC AED Coverage & Traffic Flow Insights**

The maps below display AED locations (top map) and average traffic volumes (bottom map) captured between years 2019 to 2024 across NYC boroughs. 
You ca can interact with the AED icons and traffic circles to explore:

* AED locations
* AED counts
* AED trained personnel
* traffic intensity
* average traffic volume.

```{r, setup, warning=FALSE,message=FALSE}

#libraries 
library(tidyverse)
library(stringr)
library(leaflet)
library(tigris)
options(tigris_use_cache = TRUE)
library(sf)
library(RColorBrewer)

# Importing dataset

traffic_volume_df = read.csv("clean_data/traffic_clean.csv")

aed_inventory_df = read.csv("clean_data/aed_clean.csv")
```

```{r, aed map}
# NYC borough setup 
boroughs = counties(state = "NY", cb = TRUE) |>
  filter(NAME %in% c("Bronx", "Kings", "New York", "Queens", "Richmond")) |>
  st_transform(4326) |>
  mutate(
    borough = case_when(
      NAME == "Bronx" ~ "Bronx",
      NAME == "Kings" ~ "Brooklyn",
      NAME == "New York" ~ "Manhattan",
      NAME == "Queens" ~ "Queens",
      NAME == "Richmond" ~ "Staten Island"
    )
  )

boro_pal <- colorFactor(
  palette = "Set1",
  domain = boroughs$borough
)
# map setup
aed_clean = aed_inventory_df |>
  mutate(location = str_replace(location_point,"^POINT\\s*", "")
         )

aed_map_icon <- makeIcon(
  iconUrl = "icons/map_logo.png",
  iconWidth = 15,             
  iconHeight = 15
)

aed_map = aed_clean |>
  leaflet() |>
  addProviderTiles(providers$CartoDB.Positron) |>
   addPolygons(
    data = boroughs,
    fillColor = ~boro_pal(borough),
    fillOpacity = 0.3,
    weight = 2,
    color = ~boro_pal(borough),
    popup = ~borough,
    group = "Boroughs"
  ) |>
   addLegend(
  "bottomright",
  pal = boro_pal,
  values = boroughs$borough,
  title = "Borough"
) |>
  addMarkers(
    data = aed_clean,
    lng = ~longitude,
    lat = ~latitude,
    icon = aed_map_icon,
    popup = ~paste0(
      "<b>Location Name: </b>", entity_name, "<br>",
      "<b>Number of AEDs: </b>", aed_num_aeds, "<br>",
      "<b>Location: </b>", location, "<br>",
      "<b>Borough: </b>", borough, "<br>",
      "<b>Trained Personnel: </b>", aed_num_person_trained
    ),
    group = "AED Locations"
  ) |>

  addLayersControl(
    overlayGroups = c("Boroughs"),
    options = layersControlOptions(collapsed = FALSE)
  )

aed_map
```


```{r, traffic intersections on a borough level}

# Converting wkt to sf point geometry (NYC uses EPSG 2263)
traffic_sf = traffic_volume_df |>
  mutate(
    geometry = st_as_sfc(wkt_geom, crs = 2263)
    ) |>
  st_as_sf() |>
  st_transform(4326) |>
  mutate(
    lon = st_coordinates(geometry)[,1],
                         lat = st_coordinates(geometry)[,2]
    ) # Converting to lat/long for leaflet

#Aggregating traffic volumes

traffic_summary = traffic_sf |>
  group_by(segment_id,street,from_st,to_st,boro) |>
  summarise(
    mean_vol = mean(vol, na.rm = TRUE),
    max_vol = max(vol, na.rm = TRUE),
    n_obs = n(),
    lon = first(lon),
    lat = first(lat),
    .groups = "drop"
  )

traffic_summary = st_as_sf(traffic_summary,
                           coords = c("lon", "lat"),
                           crs = 4326)

#mapping overall traffic volume in the dataset

traffic_map = traffic_summary |>
  leaflet() |>
  addProviderTiles(providers$OpenStreetMap) |>
   addPolygons(
    data = boroughs,
    fillColor = ~boro_pal(borough),
    fillOpacity = 0.3,
    weight = 2,
    color = ~boro_pal(borough),
    popup = ~borough,
    group = "Boroughs"
  ) |>
   addLegend(
  "topleft",
  pal = boro_pal,
  values = boroughs$borough,
  title = "Borough"
) |>
  addProviderTiles(providers$OpenStreetMap) |>
  addCircleMarkers(
    lng = ~lon,
    lat = ~lat,
    radius = ~ scales::rescale(mean_vol, to = c(3,15)),
    color= ~ case_when(
      mean_vol < 200 ~ "lightgreen",
      mean_vol < 400 ~ "orange",
      TRUE ~ "red"
    ),
    stroke = FALSE,
    fillOpacity = 0.7,
    popup = ~paste0(
      "<b>Street: </b>", street, "<br>",
      "<b>Avg Volume: </b>", round(mean_vol), "<br>"
    ),
    group = "Traffic Volume"
  ) |>
  addLayersControl(
    overlayGroups = c("Boroughs", "Traffic Volume"),
    options = layersControlOptions(collapsed = FALSE)
  ) |>
  addLegend(
    position = "bottomright",
    colors = c("lightgreen", "orange", "red"),
    labels = c("Low", "Medium", "High"),
    title = "Mean Traffic Volume"
  )

traffic_map
```


### **Data Source** 

**1) NYC Automated External Defibrillator (AED) Inventory**  
Lists registered AED locations in public facilities across NYC.  
Source: NYC Open Data (DOHMH)  
https://data.cityofnewyork.us/Health/New-York-City-Automated-External-Defibrillator-AED/2er2-jqsx/about_data  

**2) Automated Traffic Volume Counts (2019–2024)**  
Lists vehicle counts by intersection, year, and borough.  
Source: NYC Open Data (DOT)  
https://data.cityofnewyork.us/Transportation/Automated-Traffic-Volume-Counts/7ym2-wayt/about_data  

**3) NYC Leading Causes of Death (through 2021)**  
Annual cause-specific mortality data aggregated citywide.  
Source: NYC Open Data (DOHMH)  
https://data.cityofnewyork.us/Health/New-York-City-Leading-Causes-of-Death/jb7j-dtam/about_data

### **Contributors and UNIs** 

1. Nichcha Subdee (ns3923)  
2. Mukta Patwari (msp2210)  
3. Medha Tulsyani (mt3866)  
4. Juhi Mattekatt (jm5916)  
5. Maliha Safdar (ms7354)





